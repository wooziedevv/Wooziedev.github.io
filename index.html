<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Wooziedev</title>
  <link rel="icon" href="https://i.hizliresim.com/sv3jcht.png" type="image/png">
  <style>
    body { font-family: Arial, sans-serif; margin:0; background:#000; color:#fff; }
    header { position:fixed; top:0; width:100%; display:flex; justify-content:space-between; align-items:center; padding:10px 20px; background:rgba(0,0,0,0.8); z-index:1000; }
    .logo { font-size:20px; font-weight:bold; }
    .menu-icon { font-size:30px; cursor:pointer; }

    /* Sidebar menü */
    .sidebar {
      position: fixed;
      top: 0; right: -300px;
      width: 300px; height: 100%;
      background: #111; padding: 20px;
      transition: right 0.3s ease;
      z-index: 2000;
    }
    .sidebar.active { right: 0; }
    .sidebar h2 { margin-bottom:20px; }
    .sidebar a {
      display:block; color:#fff; padding:10px 0;
      text-decoration:none; border-bottom:1px solid #333;
    }
    .sidebar a:hover { color:cyan; }

    main { padding:80px 20px; }

    /* Profil alanı */
    #profilePage { display:none; max-width:500px; margin:auto; background:#111; padding:20px; border-radius:10px; }
    #profilePage h2 { margin-bottom:10px; }
    input, button { padding:8px; margin:6px 0; width:100%; }
    img { max-width:100px; border-radius:50%; display:block; margin-bottom:10px; }
  </style>
</head>
<body>
  <header>
    <div class="logo">WoozieDev</div>
    <div class="menu-icon" onclick="toggleMenu()">☰</div>
  </header>

  <!-- Sidebar menü -->
  <div class="sidebar" id="sidebar">
    <h2>Menü</h2>
    <a href="#" onclick="showProfile()">Profil</a>
    <a href="#">Ayarlar</a>
    <a href="#contact">İletişim</a>
    <a href="#" onclick="logout()">Çıkış</a>
  </div>

  <main>
    <h1>Ana Sayfa</h1>
    <p>Hoşgeldiniz!</p>

    <!-- Profil sayfası -->
    <div id="profilePage">
      <h2>Profilim</h2>
      <img id="profilePic" src="https://via.placeholder.com/100" alt="Profil Resmi">
      <input type="file" id="profileImageInput" accept="image/*"><br>
      <input type="text" id="profileUsername" placeholder="Kullanıcı adı">
      <input type="password" id="confirmPassword" placeholder="Şifrenizi girin (değişiklik için)">
      <input type="text" id="instagram" placeholder="Instagram kullanıcı adı">
      <input type="text" id="tiktok" placeholder="TikTok kullanıcı adı">
      <button onclick="saveProfile()">Kaydet</button>
    </div>
  </main>

  <!-- Firebase -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
    import { getAuth, updatePassword, reauthenticateWithCredential, EmailAuthProvider } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-auth.js";
    import { getFirestore, doc, setDoc, getDoc, updateDoc } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore.js";
    import { getStorage, ref, uploadBytes, getDownloadURL } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-storage.js";

    const firebaseConfig = {
      apiKey: "AIzaSyBRWCBCSNCLv2Mgz-8OAxTE_hHTcDPW9tE",
      authDomain: "wooziedevsite.firebaseapp.com",
      projectId: "wooziedevsite",
      storageBucket: "wooziedevsite.firebasestorage.app",
      messagingSenderId: "181692137747",
      appId: "1:181692137747:web:f773cfb5d4db225e70dae6"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);
    const storage = getStorage(app);

    window.toggleMenu = () => {
      document.getElementById("sidebar").classList.toggle("active");
    };

    window.showProfile = async () => {
      document.getElementById("profilePage").style.display = "block";
      toggleMenu();

      const user = auth.currentUser;
      if (!user) return alert("Giriş yapmalısınız!");

      const docRef = doc(db,"users",user.uid);
      const docSnap = await getDoc(docRef);
      if(docSnap.exists()){
        const data = docSnap.data();
        document.getElementById("profileUsername").value = data.username || "";
        document.getElementById("instagram").value = data.instagram || "";
        document.getElementById("tiktok").value = data.tiktok || "";
        if(data.profilePic){
          document.getElementById("profilePic").src = data.profilePic;
        }
      }
    };

    window.saveProfile = async () => {
      const user = auth.currentUser;
      if (!user) return alert("Giriş yapmalısınız!");

      const newUsername = document.getElementById("profileUsername").value;
      const pass = document.getElementById("confirmPassword").value;
      const instagram = document.getElementById("instagram").value;
      const tiktok = document.getElementById("tiktok").value;
      const file = document.getElementById("profileImageInput").files[0];

      // Şifre doğrulama
      if(pass){
        const credential = EmailAuthProvider.credential(user.email, pass);
        try{
          await reauthenticateWithCredential(user, credential);
        }catch(e){
          return alert("Şifre hatalı!");
        }
      } else {
        return alert("Değişiklik için şifrenizi giriniz!");
      }

      let profilePicUrl = null;
      if(file){
        const storageRef = ref(storage, "profiles/" + user.uid + ".jpg");
        await uploadBytes(storageRef,file);
        profilePicUrl = await getDownloadURL(storageRef);
      }

      await updateDoc(doc(db,"users",user.uid),{
        username: newUsername,
        instagram: instagram,
        tiktok: tiktok,
        profilePic: profilePicUrl || document.getElementById("profilePic").src
      });

      if(profilePicUrl){
        document.getElementById("profilePic").src = profilePicUrl;
      }
      alert("Profil güncellendi!");
    };

    window.logout = () => auth.signOut();
  </script>
</body>
</html>
